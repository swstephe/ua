doctype html
html(ng-app='token')
  head
    title Token Game
    link(rel='stylesheet',href='/bootstrap/css/bootstrap.css')
  body
    .container-fluid(ng-controller='tokenGameCtrl')
      h2 Find Underwater Tokens Game
      h4 Tokens to collect: {{toCollect}}
      div
        .row
          .col-sm-12
            h4
              | Tokens collected: {{collected}}&#32;
              span(ng-show='hasEnough()') [Done!]
      div(
        ng-repeat='diver in divers'
        diver-panel
        diver-name='{{diver}}'
        counter='$parent.collected'
      )
    script(src='/angular/angular.js')
    script
      :coffee-script
        angular
        .module 'token', []
        .constant 'initialGoal', 10
        .controller 'tokenGameCtrl', ($scope, initialGoal) ->
          $scope.divers = ["Bob", "Cecile", "Jake"]
          $scope.toCollect = initialGoal
          $scope.collected = 0
          $scope.hasEnough = -> $scope.toCollect <= $scope.collected
        .directive 'diverPanel', ->
          scope:
            diver: '@diverName'
            allFound: '=counter'
          templateUrl: 'diverPanel.html'
          link: (scope, element, attrs) ->
            scope.tokensFound = 0
            scope.diver = attrs['diverName']
            scope.found = ->
              scope.tokensFound++
              scope.allFound++
            scope.lost = ->
              scope.tokensFound--
              scope.allFound--
